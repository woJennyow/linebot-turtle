const line = require('@line/bot-sdk');
const express = require('express');
const app = express();

const config = {
  channelAccessToken: 'cTOKJdSRlL8LYBgrQtKCB/DZ3ajAOHYN2aZyh3j+Gs4j6sK6lo78Um29Vo+W34RQi2jzRUecamad5II9RnKCMkZ5EeSBkb8TQTGbhOdU7dMuUXz9aMYvGnqQQ+GJqHd/NeRTggi5ZQPMpSPf8uy0iwdB04t89/1O/w1cDnyilFU=',
  channelSecret: '7c2ce056206edad1c9adb78946f446a7'
};

const client = new line.Client(config);

const mainPrompt = `é¡Œå¹¹ï¼š
è‡ªå¾žé˜¿æ˜Žè¢«çˆ¸çˆ¸èƒ–æä¸€é “ä¹‹å¾Œå°±é–‹å§‹é »ç¹åœ°æ’¿ç ´çˆ›ï¼Œ
çœ‹è¦‹é˜¿æ˜Žé€™éº¼åšï¼Œå§Šå§Šçš„çœ¼ç¥žå¾ˆæ˜¯è¤‡é›œã€‚

å¯äº’å‹•é—œéµå­—ï¼š
ðŸ‘‰ é˜¿æ˜Žã€çˆ¸çˆ¸ã€ç ´çˆ›ã€å§Šå§Šã€çœ¼ç¥ž
è«‹è¼¸å…¥å…¶ä¸­ä¸€å€‹é—œéµè©žé–‹å§‹æŽ¢ç´¢ã€‚`;

const questionSets = {
  "é˜¿æ˜Ž": [
    "Q1. é˜¿æ˜Žæ˜¯å°å­©å—Žï¼Ÿ",
    "Q2. é˜¿æ˜Žçš„å€‹æ€§æ„›è¨˜ä»‡ä¸”æœ‰ä»‡å¿…å ±å—Žï¼Ÿ",
    "Q3. é˜¿æ˜Žå¤©æ€§é ‘åŠ£å—Žï¼Ÿ",
    "Q4. é˜¿æ˜Žç›¸è¼ƒæ–¼æ™®é€šå­©å­æœ‰ç‰¹æ®Šä¹‹è™•å—Žï¼Ÿ",
    "Q5. é˜¿æ˜ŽæŒ¨æ‰“å¾Œçš„è¡Œç‚ºæ˜¯æ•…æ„æƒ¹çˆ¸çˆ¸ç”Ÿæ°£å—Žï¼Ÿ"
  ],
  "çˆ¸çˆ¸": [
    "Q1. è·Ÿçˆ¸çˆ¸çš„è·æ¥­æœ‰é—œå—Žï¼Ÿ",
    "Q2. çˆ¸çˆ¸æœ¬èº«è„¾æ°£æš´èºå—Žï¼Ÿ",
    "Q3. çˆ¸çˆ¸è¨ŽåŽ­é˜¿æ˜Žå—Žï¼Ÿ",
    "Q4. çˆ¸çˆ¸æœ‰é…—é…’å—Žï¼Ÿ",
    "Q5. çˆ¸çˆ¸çœ‹ä¸èµ·é˜¿æ˜Žå—Žï¼Ÿ",
    "Q6. çˆ¸çˆ¸çœŸçš„æ˜¯è¦ªç”Ÿçˆ¶è¦ªå—Žï¼Ÿ"
  ],
  "ç ´çˆ›": [
    "Q1. é€™äº›ç ´çˆ›å¯ä»¥è³£éŒ¢å—Žï¼Ÿ",
    "Q2. é€™äº›ç ´çˆ›æœƒæ”¾åœ¨å®¶è£¡å—Žï¼Ÿ",
    "Q3. é€™äº›ç ´çˆ›å¯ä»¥åšå…¶ä»–ç”¨é€”å—Žï¼Ÿ",
    "Q4. é€™äº›ç ´çˆ›å¯ä»¥å‚·å®³åˆ¥äººå—Žï¼Ÿ",
    "Q5. é€™äº›ç ´çˆ›ç¶“éŽåŠ å·¥å¯ä»¥æˆç‚ºæ­¦å™¨å—Žï¼Ÿ"
  ],
  "å§Šå§Š": [
    "Q1. å§Šå§Šè¨ŽåŽ­é˜¿æ˜Žå—Žï¼Ÿ",
    "Q2. è·Ÿå§Šå§Šçš„è·æ¥­æœ‰é—œå—Žï¼Ÿ",
    "Q3. å§Šå§Šæ˜¯çˆ¸çˆ¸è¦ªç”Ÿçš„å—Žï¼Ÿ",
    "Q4. å§Šå§Šæ˜¯ç«¥é¤Šåª³å—Žï¼Ÿ"
  ],
  "çœ¼ç¥ž": [
    "Q1. çœ¼ç¥žä¸­æœ‰æ“”æ†‚å—Žï¼Ÿ",
    "Q2. çœ¼ç¥žä¸­æœ‰é„™å¤·å—Žï¼Ÿ",
    "Q3. çœ¼ç¥žä¸­æœ‰æƒ³æ®ºæ­»å¼Ÿå¼Ÿçš„æ®ºæ°£å—Žï¼Ÿ",
    "Q4. çœ¼ç¥žä¸­æœ‰ç”Ÿæ°£å—Žï¼Ÿ"
  ]
};

const questionAnswers = {
  "é˜¿æ˜Ž Q1": "ï¼¡æ˜¯ã€‚å†å¹¾å¹´æ‰æœƒä¸Šå°å­¸ã€‚",
  "é˜¿æ˜Ž Q2": "ï¼¡å¦ã€‚",
  "é˜¿æ˜Ž Q3": "ï¼¡å¦ã€‚ä»–æ˜¯å€‹æœƒå¹«å®¶è£¡å¹¹è¾²æ´»åšå®¶å‹™çš„ä¹–å­©å­ã€‚",
  "é˜¿æ˜Ž Q4": "ï¼¡æ˜¯ã€‚ä»–ç‰¹åˆ¥å–œæ­¡åšä¸€ä»¶äº‹ï¼Œè€Œä¸”åœ¨é€™ä»¶äº‹ä¸Šæœ‰å¤©ä»½ï¼",
  "é˜¿æ˜Ž Q5": "ï¼¡å¦ã€‚æ°å¥½ç›¸åï¼Œæ˜¯ç‚ºäº†è®“ä»¥å¾Œçˆ¸çˆ¸ä¸è¦å†ä¸é–‹å¿ƒäº†ã€‚",

  "çˆ¸çˆ¸ Q1": "ï¼¡å¦ã€‚çˆ¸çˆ¸åªæ˜¯å€‹è²§å›°åé„‰èŒ¶è¾²ï¼Œèªç‚ºå¥½å¥½è®€æ›¸æ‰æœ‰å‰é€”ã€‚",
  "çˆ¸çˆ¸ Q2": "ï¼¡å¦ã€‚çˆ¸çˆ¸ç”Ÿæ°£éƒ½æœ‰åŽŸå› ã€‚",
  "çˆ¸çˆ¸ Q3": "ï¼¡å¦ã€‚é˜¿æ˜Žä½œç‚ºå®¶ä¸­é•·å­ï¼Œçˆ¸çˆ¸å°ä»–å¯„äºˆåŽšæœ›ã€‚",
  "çˆ¸çˆ¸ Q4": "ï¼¡å¦ã€‚èªçœŸå·¥ä½œè³ºéŒ¢é¤Šå®¶çš„å‚³çµ±å¥½çˆ¸çˆ¸ã€‚",
  "çˆ¸çˆ¸ Q5": "ï¼¡å¦ã€‚é‡ç”·è¼•å¥³çš„å‚³çµ±è€çˆ¸ï¼Œå°æ–¼å…’å­é˜¿æ˜Žï¼Œå°±æ˜¯å› ç‚ºé‡è¦–æ‰è¦é‡é‡è²¬æ‰“ã€‚",
  "çˆ¸çˆ¸ Q6": "ï¼¡æ˜¯ã€‚çµ•å°æ˜¯è¦ªç”Ÿçš„ï¼Œä¸æ˜¯è¦ªç”Ÿçš„èª°ç®¡ä»–å•Šï¼Ÿ",

  "ç ´çˆ› Q1": "ï¼¡æ˜¯ã€‚ä½†ä¸å€¼å¹¾å€‹éŒ¢ã€‚",
  "ç ´çˆ› Q2": "ï¼¡æ˜¯ã€‚ä½†â€œæ”¾åœ¨å®¶è£¡â€œä¸æ˜¯é˜¿æ˜Žæ’¿çš„ä¸»è¦ç›®çš„ã€‚",
  "ç ´çˆ› Q3": "ï¼¡æ˜¯ã€‚é€™ä¼¼ä¹Žèˆ‡é˜¿æ˜Žçš„ç‰¹æ®Šä¹‹è™•æœ‰é—œã€‚",
  "ç ´çˆ› Q4": "ï¼¡å¦ã€‚ä¸å…·æœ‰ä»»ä½•å±éšªæ€§ï¼Œç”šè‡³é¢¨è¼•è¼•ä¸€å¹å¯èƒ½å°±é£„èµ°äº†ã€‚",
  "ç ´çˆ› Q5": "ï¼¡èˆ‡æ­¤ç„¡é—œã€‚å³ä½¿å¯ä»¥ç¶“éŽåŠ å·¥æˆç‚ºæ­¦å™¨ï¼Œä¹Ÿèˆ‡é˜¿æ˜Žçš„ä½¿ç”¨æ–¹å¼ç„¡é—œã€‚",

  "å§Šå§Š Q1": "ï¼¡å¦ã€‚å§Šå§Šè¨ŽåŽ­çš„æ˜¯å­¸æ ¡ç™¼çš„æ–‡å…·åªæœ‰ä¸€å¥—ï¼Œä½†ä¸€ç›´è¢«æ‹¿èµ°ã€‚",
  "å§Šå§Š Q2": "ï¼¡å¦ã€‚å§Šå§Šç›®å‰ä¸Šå°å­¸äº†ï¼Œé˜¿æ˜Žé‚„æ²’ä¸Šå­¸ã€‚",
  "å§Šå§Š Q3": "ï¼¡æ˜¯ã€‚",
  "å§Šå§Š Q4": "ï¼¡å¦ã€‚ä½ åœ¨æƒ³ä»€éº¼ï¼å§Šå§Šå’Œé˜¿æ˜Žå¯æ˜¯è¦ªå§å¼Ÿï¼",

  "çœ¼ç¥ž Q1": "ï¼¡æ˜¯ã€‚å§Šå§ŠçŸ¥é“çˆ¸çˆ¸å°é˜¿æ˜Žå¯„äºˆåŽšæœ›ï¼Œå¯æ˜¯é˜¿æ˜Žå»åšäº†äº›ä¸å‹™æ­£æ¥­çš„äº‹ã€‚",
  "çœ¼ç¥ž Q2": "ï¼¡å¦ã€‚å®¶ä¸­å¾žå°æ•™è‚²å§Šå§Šè¦è®“è‘—å¼Ÿå¼Ÿï¼Œæ‰€ä»¥å§Šå§Šä¹Ÿå­¸è‘—å¤§äººå°å¼Ÿå¼Ÿå¥½ï¼Œçœ‹é‡å¼Ÿå¼Ÿã€‚",
  "çœ¼ç¥ž Q3": "ï¼¡å¦ã€‚æœ‰é»žè¨ŽåŽ­è€Œå·²ã€‚",
  "çœ¼ç¥ž Q4": "ï¼¡æœ‰ã€‚ã€Œä¸è¦å†æ‹¿äº†ï¼ã€å§Šå§Šèªªã€‚"
};

app.post('/webhook', line.middleware(config), (req, res) => {
  Promise.all(req.body.events.map(handleEvent)).then(result => res.json(result));
});

async function handleEvent(event) {
  if (event.type !== 'message' || event.message.type !== 'text') {
    return Promise.resolve(null);
  }

  const msg = event.message.text.trim();

  if (msg === "é–‹å§‹éŠæˆ²") {
    return client.replyMessage(event.replyToken, {
      type: "text",
      text: mainPrompt
    });
  }

  if (questionSets[msg]) {
    const list = questionSets[msg].join('\n');
    return client.replyMessage(event.replyToken, {
      type: "text",
      text: `ä½ é¸æ“‡äº†ã€Œ${msg}ã€ï¼Œè«‹è¼¸å…¥é¡Œè™ŸæŸ¥çœ‹ç­”æ¡ˆï¼š\n${list}\n\nä¾‹å¦‚è¼¸å…¥ï¼š${msg} Q1`
    });
  }

  if (questionAnswers[msg]) {
    const answer = questionAnswers[msg];
    return client.replyMessage(event.replyToken, [
      {
        type: "text",
        text: answer
      },
      {
        type: "text",
        text: mainPrompt
      }
    ]);
  }

  return client.replyMessage(event.replyToken, {
    type: "text",
    text: "è«‹è¼¸å…¥ã€Œé–‹å§‹éŠæˆ²ã€ä¾†é–‹å§‹äº’å‹•ï¼Œæˆ–è¼¸å…¥é—œéµè©žå¦‚ã€Œé˜¿æ˜Žã€ä¾†æŸ¥çœ‹å•é¡Œåˆ—è¡¨ã€‚"
  });
}

app.listen(process.env.PORT || 3000, () => {
  console.log('server started');
});

